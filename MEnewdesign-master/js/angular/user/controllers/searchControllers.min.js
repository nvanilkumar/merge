

/*** cnvyr.min.js ***/
angular.module("searchModule").controller("filterController",["$scope","$http",function(a,f){a.selectedCityId=defaultCityId;a.splcitystateId=defaultSplCityStateId;a.selectedCityName="";a.selectedCategoryName=defaultCategoryName;if(getCookie("subCategoryName")==""){defaultSubCategoryName="SubCategories"}a.selectedSubCategoryName=defaultSubCategoryName;a.selectedCategoryClass=defaultCategoryName.replace(" ","");a.selectedCategoryId=defaultCategoryId;a.selectedCustomFilterId="";a.selectedSubcategoryId=defaultSubCategoryId;a.selectedCountryId=defaultCountryId;a.typeValue="";a.typeName="All";a.keyword=$("#searchId").val();a.freeCount=0;a.paidCount=0;a.noRegCount=0;a.allReg=0;a.webinarCount=0;a.totalResultCount=totalResultCount;a.matchingKeyword=defaultMatchingKeyword;a.selectedCustomFilterName="";a.cityList="";a.categoryList="";a.customFilterList="";a.customDateValue="";a.pageValue=1;a.limitValue=12;a.init=function(i,h){if(h=="city"){a.cityList=i}if(h=="category"){a.categoryList=i}if(h=="customFilter"){a.customFilterList=i;a.customDateValue="";a.$watch("customDateValue",function(){})}if(h=="subCategoryList"){a.subCategoryList=i}var g=0;$.each(i,function(j,k){g+=k.count});a.allsubCategoryCount=g};a.reset=function(){$("#dvLoading").show();a.pageValue=1;a.limitValue=12;a.selectedCityId=0;a.selectedCategoryId=0;a.selectedCustomFilterId=6;a.selectedSubcategoryId=0;a.splcitystateId=0;a.typeValue="";a.typeName="All";$(".custom_date").val("");$(".CustomFilterClass").html("Time");$(".showSubCategories").html("");$("#showSubCategoriesAnchor").html("");$("#subcat").css("cssText","display: none !important;");$("#subcat2").css("display","none");$("#subcat1").css("display","none");$(".categoryClass").html("All Categories");a.selectedCategoryName="All categories";a.selectedCategoryClass="AllCategories";$(".subCategoryClass").text("Subcategories");$(".cityClass").text(defaultCountryName);a.selectedCityName="All Cities";a.selectedCustomFilterName="Time";a.$broadcast("angucomplete-alt:clearInput","ex5");a.$broadcast("angucomplete-alt:clearInput","subCat");a.$broadcast("angucomplete-alt:clearInput","subCat");var g={names:["cityId","categoryId","dayFilter","subCategoryId","splCityStateId"],values:[a.selectedCityId,a.selectedCategoryId,a.selectedCustomFilterId,a.selectedSubcategoryId,a.splcitystateId]};updateCookieservice(g);$(".filterdiv").hide();a.keyword=$("#searchId").val();a.getEventList(a.selectedCountryId,a.selectedCityId,a.selectedCategoryId,a.selectedSubcategoryId,a.selectedCustomFilterId,a.typeValue,a.pageValue,a.limitValue,a.typeName,a.keyword,a.splcitystateId)};a.getEventRegCount=function(){var h="";var i={};var g=$("#searchId").val();i.countryId=a.selectedCountryId;if(a.selectedCityId!=0){if(a.splcitystateId!=0){i.stateId=a.splcitystateId}else{i.cityId=a.selectedCityId}}i.categoryId=a.selectedCategoryId;if(a.selectedSubcategoryId>0){i.subcategoryId=a.selectedSubcategoryId}if(g!=""&&g!=0&&typeof(g)!="undefined"){i.keyword=g}if(a.selectedCustomFilterId>0){i.day=a.selectedCustomFilterId;if(a.selectedCustomFilterId==7){i.dateValue=$("#datepicker").val()}}h=api_eventEventsCount;f({method:"GET",url:h,params:i,headers:{"Content-Type":"application/x-www-form-urlencoded",Authorization:"bearer 930332c8a6bf5f0850bd49c1627ced2092631250"}}).success(function(n,k,o,m){var p=n.response.eventCountByRegTypeList;a.freeCount=p[1];a.paidCount=p[2];a.noRegCount=p[3];a.webinarCount=p[4];a.allReg=p[5];for(var l=1;l<=4;l++){if(p[l]==0){$("#"+l+"_type").css("display","none")}else{$("#"+l+"_type").css("display","inline-block")}}}).error(function(l,j,m,k){window.location.href=site_url})};a.getSubCategoryCount=function(){$("#isSubCatClosed").val("1");var h="";var i={};i.countryId=a.selectedCountryId;if(a.selectedCityId!=0){if(a.splcitystateId!=0){i.stateId=a.splcitystateId}else{i.cityId=a.selectedCityId}}i.categoryId=a.selectedCategoryId;if(a.typeName!=""&&a.typeName!="All"){i.eventType=a.typeName}var g=$("#searchId").val();if(g!=""&&g!=0&&typeof(g)!="undefined"){i.keyword=g}if(a.selectedCustomFilterId>0){i.day=a.selectedCustomFilterId;if(a.selectedCustomFilterId==7){i.dateValue=$("#datepicker").val()}}h=api_subcategoryEventsCount;f({method:"GET",url:h,params:i,headers:{"Content-Type":"application/x-www-form-urlencoded",Authorization:"bearer 930332c8a6bf5f0850bd49c1627ced2092631250"}}).success(function(l,j,m,k){a.init(l.response.count,"subCategoryList")}).error(function(l,j,m,k){window.location.href=site_url})};var e="",c="";var d="",b="";a.setFilter=function(l,j,k,m,g){if(l=="city"){if(m!=1){a.$broadcast("angucomplete-alt:clearInput","ex5")}a.selectedCityId=j;a.splcitystateId=g;if(k==="All Cities"){k=defaultCountryName}a.selectedCityName=k;e="cityId";c=j;d="splCityStateId";b=g;$(".filterdiv").slideUp();$(".showSubCategories").html("Show Sub Categories");$("#showSubCategoriesAnchor").html("Show Sub Categories");var i={names:[e,d],values:[c,b]};updateCookieservice(i)}if(l=="category"){a.selectedCategoryId=j;a.selectedSubcategoryId="";a.selectedSubCategoryName="SubCategories";
a.selectedCategoryClass=k.replace(" ","");a.selectedCategoryName=k;if(a.selectedCategoryId==0){$("#subcat").css("cssText","display: none !important;");$("#subcat1").css("display","none")}else{$("#subcat").css("display","");$("#subcat1").css("display","")}if(m!=1){a.$broadcast("angucomplete-alt:clearInput","subCat")}$(".showSubCategories").html("Show Sub Categories");$(".subCategoryClass").html(" Subcategories ");$("#showSubCategoriesAnchor").html("Show Sub Categories");$(".filterdiv").slideUp();var i={names:["subCategoryId","categoryId"],values:[0,j]};updateCookieservice(i)}if(l=="CustomFilter"){a.selectedCustomFilterId=j;a.selectedCustomFilterName=k;if(m!=1){$(".custom_date").val("")}e="dayFilter";c=j;$(".showSubCategories").html("Show Sub Categories");$("#showSubCategoriesAnchor").html("Show Sub Categories");$(".filterdiv").slideUp();var i={names:["dayFilter"],values:[j]};updateCookieservice(i)}if(l=="Subcategory"){if(m!=1){a.$broadcast("angucomplete-alt:clearInput","subCat")}a.selectedSubcategoryId=j;a.selectedSubCategoryName=k;$(".filterdiv").slideUp();$(".subCategoryClass").text(k);var i={names:["subCategoryId"],values:[j]};updateCookieservice(i)}if(l=="freepaid"){a.typeValue=j;a.typeName=k.charAt(0).toUpperCase()+k.slice(1);$(".filterdiv").slideUp()}if(k!="Custom Date"){$("."+l+"Class").html(k)}a.pageValue=1;a.limitValue=12;var h=$("#searchId").val();if(h!=""&&h!=0&&typeof(h)!="undefined"){a.getEventList(a.selectedCountryId,a.selectedCityId,a.selectedCategoryId,a.selectedSubcategoryId,a.selectedCustomFilterId,a.typeValue,a.pageValue,a.limitValue,a.typeName,h,a.splcitystateId)}else{a.getEventList(a.selectedCountryId,a.selectedCityId,a.selectedCategoryId,a.selectedSubcategoryId,a.selectedCustomFilterId,a.typeValue,a.pageValue,a.limitValue,a.typeName,h,a.splcitystateId)}};a.indexedArray=function(h,g){var i={};angular.forEach(h.response.count,function(k,j){if(g=="city"){var j=k.type+"-"+k.id}if(g=="category"){var j=k.id}if(g=="customFilter"){var j=k.id}i[j]=k.count});return i};a.getEventCount=function(h,j){var i="";var g=$("#searchId").val();var k={};k.countryId=a.selectedCountryId;if(j=="city"){$(".showSubCategories").html("Show Sub Categories");$("#showSubCategoriesAnchor").html("Show Sub Categories");if(a.typeName!=""&&a.typeName!="All"){k.eventType=a.typeName}i=api_cityEventsCount;if(a.selectedCategoryId>0){k.categoryId=a.selectedCategoryId}if(a.selectedSubcategoryId>0){k.subcategoryId=a.selectedSubcategoryId}if(a.selectedCustomFilterId>0){k.day=a.selectedCustomFilterId;if(a.selectedCustomFilterId==7){k.dateValue=$("#datepicker").val()}}if(g!=""&&g!=0&&typeof(g)!="undefined"){k.keyword=g}}if(j=="category"){$(".showSubCategories").html("Show Sub Categories");$("#showSubCategoriesAnchor").html("Show Sub Categories");i=api_categoryEventsCount;if(a.typeName!=""&&a.typeName!="All"){k.eventType=a.typeName}k.major=0;if(a.selectedCityId>0){if(a.splcitystateId!=0){k.stateId=a.splcitystateId}else{k.cityId=a.selectedCityId}}if(a.selectedCategoryId>0){k.categoryId=a.selectedCategoryId}if(a.selectedCustomFilterId>0){k.day=a.selectedCustomFilterId;if(a.selectedCustomFilterId==7){k.dateValue=$("#datepicker").val()}}if(g!=""&&g!=0&&typeof(g)!="undefined"){k.keyword=g}}if(j=="customFilter"){$(".showSubCategories").html("Show Sub Categories");$("#showSubCategoriesAnchor").html("Show Sub Categories");if(a.typeName!=""&&a.typeName!="All"){k.eventType=a.typeName}i=api_filterEventsCount;if(a.selectedCityId>0){if(a.splcitystateId!=0){k.stateId=a.splcitystateId}else{k.cityId=a.selectedCityId}}if(a.selectedCategoryId>0){k.categoryId=a.selectedCategoryId}if(a.selectedSubcategoryId>0){k.subcategoryId=a.selectedSubcategoryId}if(g!=""&&g!=0&&typeof(g)!="undefined"){k.keyword=g}}f({method:"GET",url:i,params:k,headers:{"Content-Type":"application/x-www-form-urlencoded",Authorization:"bearer 930332c8a6bf5f0850bd49c1627ced2092631250"}}).success(function(n,l,p,m){var o=a.indexedArray(n,j);if(j=="city"){a.updateCityCount(a.cityList,o);a.allCityCount="("+n.response.allCount+")"}else{if(j=="category"){a.updateCount(a.categoryList,o,j);a.allCategoryCount="("+n.response.allCount+")"}else{if(j=="customFilter"){a.updateCount(a.customFilterList,o,j)}}}}).error(function(n,l,o,m){window.location.href=site_url})};a.updateCityCount=function(g,h){angular.forEach(g,function(k){var j="city";var l=k.id;if(k.splcitystateid>0){var j="state";var l=k.splcitystateid}var i=j+"-"+l;if(h.hasOwnProperty(i)){if(h[i]>0){k.eventCount="("+h[i]+")";$("#"+k.id+"_city").css("display","inline-block");$("#"+k.id+"_mobcity").css("display","inline-block")}else{$("#"+k.id+"_city").css("display","none");$("#"+k.id+"_mobcity").css("cssText","display: none !important;")}}})};a.updateCount=function(h,i,g){angular.forEach(h,function(j){if(i.hasOwnProperty(j.id)){if(i[j.id]>0){j.eventCount="("+i[j.id]+")";$("#"+j.id+"_category").css("display","inline-block");$("#"+j.id+"_mobcategory").css("display","inline-block");if(g=="customFilter"){$("#"+j.id+"_dates").css("display","inline-block");
$("#"+j.id+"_mobdates").css("display","inline-block")}}else{if(g=="customFilter"){$("#"+j.id+"_dates").css("display","none");$("#"+j.id+"_mobdates").css("cssText","display: none !important;")}$("#"+j.id+"_category").css("display","none");$("#"+j.id+"_mobcategory").css("cssText","display: none !important;")}}else{if(g=="customFilter"&&j.id==6){j.eventCount=""}else{$("#"+j.id+"_category").css("display","none");$("#"+j.id+"_mobcategory").css("cssText","display: none !important;")}}})};a.defaultFilter=function(){a.selectedCityId=defaultCityId;a.selectedCountryId=defaultCountryId;if(defaultCityName==="All Cities"){cityName=defaultCountryName}else{cityName=defaultCityName}a.selectedCityName=cityName};a.getEventList=function(j,m,h,k,s,r,q,l,u,o,i){var v="";var t="none";v+="?countryId="+j;if(m!=0){if(i!=0){v+="&stateId="+i}else{v+="&cityId="+m}}else{if(m==0){t="block"}}if(h!=0){v+="&categoryId="+h}if(k!=0){v+="&subcategoryId="+k}if(s!=0){v+="&day="+s}if(s==7){v+="&dateValue="+$("#datepicker").val()}if(r!=""&&r!=0){if(r==4){v+="&eventMode=1"}else{v+="&registrationType="+r}}var w=api_eventList;if(o!=""&&o!=0&&typeof(o)!="undefined"){v+="&keyWord="+o;w=api_searchSearchEvent}v+="&page="+q+"&limit="+l;f({method:"GET",async:false,url:w+v,headers:{"Content-Type":"application/x-www-form-urlencoded",Authorization:"bearer 930332c8a6bf5f0850bd49c1627ced2092631250"}}).success(function(E,C,z,A){var K="";a.totalResultCount=E.response.total;if(typeof tsa!==typeof undefined){var B=$(".subCategoryClass").html().trim();console.log(B);console.log("HERE IT IS ABOVE");if(B=="SubCategories"||B=="Subcategories"){B=""}var J=$(".CustomFilterClass").html();var H=$(".freepaid").html();var y=new Array(J.charAt(0).toUpperCase()+J.slice(1),H.charAt(0).toUpperCase()+H.slice(1));console.log(a.keyword);console.log(a.totalResultCount);console.log($(".cityClass").html());console.log($(".categoryClass").html());console.log(B);console.log(y);tsa.activity_data={skeyword:a.keyword,sresults:a.totalResultCount,scity:$(".cityClass").html(),scategory:$(".categoryClass").html(),ssubcategory:B,sfilter:y};if(typeof window.ts!==typeof undefined){console.log("SAVING");ts.save_parameters()}}if(E.response.total>0){$("#nosearchresults").css("display","none");var F=E.response.eventList.length;for(var D=0;D<F;D++){var x=E.response.eventList[D];var G=x.cityName;if(typeof(G)=="undefined"){G=""}var I=x.eventUrl;if(x.eventExternalUrl!=undefined){I=x.eventExternalUrl}K+='<li class="col-xs-12 col-sm-6 col-md-4 col-lg-4 thumbBlock">';K+='<a href="'+I+'" class="thumbnail">';K+='<div class="eventImg">';K+='<img src="'+x.thumbImage+'" width="" height="" alt="'+x.title+' " title="'+x.title+'" onError="this.src=\''+x.defaultThumbImage+"'\" />";K+="</div><h2>";K+='       <span class="eveHeadWrap">'+x.title+"</span>";K+="   </h2>";K+='   <div class="info">';K+="       <span>"+convertDate(x.startDate)+"</span> <span>at</span> <span>Hardrock";K+="               Cafe</span>";K+="   </div>";K+='<div class="eventCity" style="display:'+t+'">';K+="<span>"+G+"</span></div>";K+='   <div class="overlay">';K+='       <div class="overlayButt">';K+='           <div class="overlaySocial">';K+='               <span class="icon-fb"></span> <span class="icon-tweet"></span>';K+='               <span class="icon-google"></span>';K+="           </div>";K+="       </div>";K+="   </div>";K+='</a> <a href="'+I+'" class="category">';K+='<span class="icon-'+x.categoryName.toLowerCase().replace(" ","")+" col"+x.categoryName.toLowerCase().replace(" ","")+'"></span> <span class="catName"><em>'+x.categoryName+"</em></span>";K+="</a>";K+="</li>"}$("ul#eventThumbs").html(K);if(E.response.nextPage==false){$("#viewMoreEvents").css("display","none");$("#noMoreEvents").css("display","block")}else{a.pageValue++;$("#viewMoreEvents").css("display","inline-block");$("#noMoreEvents").css("display","none")}}else{if(q==1){$("ul#eventThumbs").html(K)}$("#viewMoreEvents").css("display","none");$("#noMoreEvents").css("display","none");$("#nosearchresults").css("display","block")}$("#dvLoading").hide()}).error(function(z,x,A,y){window.location.href=site_url});if(a.keyword!=""){a.matchingKeyword="matching '"+a.keyword+"'";var g="search?keyword="+encodeURIComponent(a.keyword)}else{a.matchingKeyword="";var g="search"}var p="search";var n={Page:p,Url:g};history.pushState(n,n.Page,n.Url)};a.getMoreEvents=function(){if(a.pageValue==1){a.pageValue=2}var j="";var h="none";j+="?countryId="+a.selectedCountryId;if(a.selectedCityId!=0){if(a.splcitystateId!=0){j+="&stateId="+a.splcitystateId}else{j+="&cityId="+a.selectedCityId}}else{if(a.selectedCityId==0){h="block"}}if(a.selectedCategoryId!=0){j+="&categoryId="+a.selectedCategoryId}if(a.selectedSubcategoryId!=0){j+="&subcategoryId="+a.selectedSubcategoryId}if(a.selectedCustomFilterId!=0){j+="&day="+a.selectedCustomFilterId}if(a.typeValue!=0){if(a.typeValue==4){j+="&eventMode=1"}else{j+="&registrationType="+a.typeValue}}if(a.selectedCustomFilterId==7){j+="&dateValue="+$("#datepicker").val()
}var i=api_eventList;var g=$("#searchId").val();a.keyword=g;if(a.keyword!=""&&a.keyword!=0&&typeof(a.keyword)!="undefined"){j+="&keyWord="+a.keyword;i=api_searchSearchEvent}if(a.pageValue!=0){j+="&page="+a.pageValue+"&limit="+a.limitValue}f({method:"GET",url:i+j,headers:{"Content-Type":"application/x-www-form-urlencoded",Authorization:"bearer 930332c8a6bf5f0850bd49c1627ced2092631250"}}).success(function(o,n,l,m){if(o.response.total>0){var s="";var q=o.response.eventList.length;for(var p=0;p<q;p++){var k=o.response.eventList[p];var r=k.eventUrl;if(k.eventExternalUrl!=undefined){r=k.eventExternalUrl}s+='<li class="col-xs-12 col-sm-6 col-md-4 col-lg-4 thumbBlock">';s+='<a href="'+r+'" class="thumbnail">';s+='<div class="eventImg">';s+='<img src="'+k.thumbImage+'" width="" height="" alt="'+k.title+'" title="'+k.title+'" onError="this.src=\''+k.defaultThumbImage+"'\" />";s+="</div><h2>";s+='<span class="eveHeadWrap">'+k.title;s+='</h2><div class="info">';s+="<span>"+convertDate(k.startDate)+"</span> ";s+="</div>";s+='<div class="eventCity" style="display:'+h+'">';s+="<span>"+k.cityName+"</span></div>";s+='<div class="overlay"><div class="overlayButt"><div class="overlaySocial">';s+='<span class="icon-fb"></span> <span class="icon-tweet"></span>';s+='<span class="icon-google"></span></div></div></div>';s+='</a> <a href="'+r+'" class="category">';s+='<span class="icon-'+k.categoryName.toLowerCase().replace(" ","")+" col"+k.categoryName.toLowerCase().replace(" ","")+'"></span>';s+='<span class="catName"><em>'+k.categoryName+"</em></span> </a> </li>"}$("ul#eventThumbs").append(s);a.pageValue++;if(o.response.nextPage==false){$("#viewMoreEvents").css("display","none");$("#noMoreEvents").css("display","block")}else{if(o.response.nextPage==true){$("#viewMoreEvents").css("display","inline-block");$("#noMoreEvents").css("display","none")}}}else{if(a.pageValue==1){$("ul#eventThumbs").append(s)}$("#viewMoreEvents").css("display","none");$("#noMoreEvents").css("display","block")}}).error(function(m,k,n,l){window.location.href=site_url})};a.citySearchValue="";a.subCatSearchValue="";a.cityChanged=function(g){a.citySearchValue=g};a.remoteRequestCity=function(g){return{major:0,keyWord:g,countryId:a.selectedCountryId,limit:5}};a.citySelected=function(g){a.setFilter("city",g.originalObject.id,g.title,1,0)};a.subcategorySelected=function(g){a.setFilter("Subcategory",g.originalObject.id,g.title,1,0)};a.remoteRequestSubCat=function(g){return{major:1,keyword:g,categoryId:a.selectedCategoryId,limit:5}};a.subCatChanged=function(g){a.subCatSearchValue=g};a.keywordSearch=function(g){a.pageValue=1;a.limitValue=12;if(g==13){$("#ui-id-2").hide();$(".icon-me_search").blur();a.keyword=$("#searchId").val();if($.isNumeric(a.keyword)){$.ajax({type:"GET",url:api_searchSearchEventAutocomplete+"?term="+a.keyword,headers:{"Content-Type":"application/x-www-form-urlencoded",Authorization:"bearer 930332c8a6bf5f0850bd49c1627ced2092631250"},success:function(h){if(h.length==1){window.location.href=site_url+"event/"+h[0].url}},error:function(h){}})}a.getEventList(a.selectedCountryId,a.selectedCityId,a.selectedCategoryId,a.selectedSubcategoryId,a.selectedCustomFilterId,a.typeValue,1,a.limitValue,a.typeName,a.keyword,a.splcitystateId)}}}]);