

/*** cnvyr.min.js ***/
$(document).ready(function(){customRadio("reportType");$("#selectTransType").on("change",function(){var e=$("#eventId").val();var b="summary";var a=$("#qString").val();if(this.value!="incomplete"&&this.value!="cancel"){var d=$("input:radio[name=reportType]:checked");if(d.length>0){b=d.val()}}else{if(this.value=="cancel"){b="detail"}}var f=$("#selectTicketType").val();var c=url_dashboardReports+"/"+e+"/"+b+"/"+this.value+"/1";if(f>0&&a!=""){c+="?ticketid="+f+"&"+a}else{if(f>0){c+="?ticketid="+f}else{if(a!=""){c+="?"+a}}}window.location=c});$("#downloadAll").on("click",function(){var f=api_reportsDownloadImages;var b=$("#eventId").val();var d=$("#selectTransType").val();var j=$("input:radio[name=reportType]:checked");var h="";if(j.length>0){h=j.val()}var c=$("#currencyCode").val();var i=$("#promoterCode").val();var e=$("#selectTicketType").val();var k="eventid="+b+"&reporttype="+h+"&transactiontype="+d;if(c!=""){k+="&currencycode="+c}if(i!=""){k+="&promotercode="+i}if(e>0){k+="&ticketid="+e}k+="&downloadall=1";var a="POST";var l="json";$("#download_files").html('<img id="success-img" src="'+site_url+'../images/me-loading.gif">');getPageResponse(f,a,k,l,m,g);function g(n){alert(n.responseJSON.response.messages);$("#sendsuccess").html(n.responseJSON.response.messages);setTimeout(function(){$("#sendsuccess").html("")},2000)}function m(n){console.dir(n.response.filepath);if(typeof(n.response)!="undefined"){var o=downloadAllImages(n.response.filepath);if(o==true){$("#download_files").html("Files Downloaded");setTimeout(function(){$("#download_files").html("")},2000)}}else{$("#download_files").html("Error In File Downloading.Try Again");setTimeout(function(){$("#download_files").html("")},2000)}}});$("#selectTicketType").on("change",function(){var e=$("#eventId").val();var b="";var d=$("input:radio[name=reportType]:checked");if(d.length>0){b=d.val()}var g=$("#selectTransType").val();var a=$("#qString").val();var f=this.value;var c=url_dashboardReports+"/"+e+"/"+b+"/"+g+"/1";if(f>0&&a!=""){c+="?ticketid="+f+"&"+a}else{if(f>0){c+="?ticketid="+f}else{if(a!=""){c+="?"+a}}}window.location=c});$("input[type=radio][name=reportType]").on("change",function(){var c=$("#eventId").val();var e=$("#selectTransType").val();var a=$("#qString").val();var b=url_dashboardReports+"/"+c+"/"+this.value+"/"+e+"/1";var d=$("#selectTicketType").val();if(d>0&&a!=""){b+="?ticketid="+d+"&"+a}else{if(d>0){b+="?ticketid="+d}else{if(a!=""){b+="?"+a}}}window.location=b});$("#loadMoreTransactions").on("click",function(){$("#loadMoreTransactions").prop("disabled",true);$("#loadMoreTransactions").text("processing...");var b=$("#eventId").val();var c=$("#selectTransType").val();var o=$("#qString").val();var j=$("input:radio[name=reportType]:checked");var i="";if(j.length>0){i=j.val()}var k=$("#page").val();var e=$("#selectTicketType").val();var f=$("#totalTransactionCount").val();var d=$("#displaylimit").val();$("#page").val(++k);var l="page="+k+"&eventid="+b+"&reporttype="+i+"&transactiontype="+c;if(e>0&&o!=""){l+="&ticketid="+e+"&"+o}else{if(e>0){l+="&ticketid="+e}else{if(o!=""){l+="&"+o}}}var g=api_reportsGetReportDetails;var a="POST";var m="JSON";function n(q){if(q.response.total>0){var p=$("#SNo").val();if(typeof $("#custIds").val()!=="undefined"){var s=JSON.parse($("#custIds").val())}var r="";if(i=="detail"){$.each(q.response.transactionList,function(t,u){$.each(u,function(v,w){$.each(w.ticketDetails,function(x,y){r+="<tr><td>"+p+++"</td><td>"+w.id+"</td><td>"+w.signupDate+"</td><td>"+y.tickettype+"</td>";if(c=="affiliate"){r+="<td>"+y.promotercode+"</td>"}r+="<td>"+w.contactDetails.name+"<br>"+w.contactDetails.email+"<br>"+w.contactDetails.phone;r+="<td>"+y.quantity+"</td>";r+="<td>"+y.amount+"</td>";if(c!="incomplete"){r+="<td>"+w.paid+"</td>";r+="<td>"+w.discount+"</td>"}else{r+="<td>"+y.failedcount+"</td>";r+="<td>"+w.comment+"</td>"}if(c=="cod"){r+="<td>"+y.comment+"</td>";r+="<td>"+y.status+"</td>";r+="<td>"+y.deliverystatus+"</td>"}if(s!=null&&typeof s!=="undefined"&&s.length>0){$.each(s,function(A,z){var B="";if(y.customfields[z]!=="undefined"&&z in y.customfields){B=y.customfields[z].value}if(B!==""){r+='<td><a href="'+B+'" target="_blank">View</a> | <br/><a href="'+site_url+"home/download?filePath="+B+'">Download</a></td>'}else{r+="<td>&nbsp;</td>"}})}r+="</tr>";$("#transactionTable tr:last").after(r);r=""})})})}else{$.each(q.response.transactionList,function(v,w){var u=1,t=Object.keys(w.ticketDetails).length;$.each(w.ticketDetails,function(y,A){var D=(u==1)?(p++):"";r+=("<tr><td>"+D+"</td>");if(c!="incomplete"){var x=(u==1)?w.id:"";r+=("<td>"+x+"</td>")}var z=(u==1)?w.signupDate:"";r+=("<td>"+z+"</td>");r+=("<td>"+A.tickettype+"</td><td>"+w.contactDetails["name"]+"<br>"+w.contactDetails["email"]+"<br>"+w.contactDetails["phone"]+"</td><td>"+A.quantity+"</td><td>"+A.amount+"</td>");if(c!="incomplete"){var B=(t==u)?w.paid:"";var C=(t==u)?w.discount:"";r+=("<td>"+B+"</td>");r+=("<td>"+C+"</td>")}else{r+=("<td>"+A.failedcount+"</td>");r+=("<td>"+A.comment+"</td>")
}if(s!=null&&typeof s!=="undefined"&&s.length>0&&(t==u)){$.each(s,function(E,G){var F="";if(typeof w.customfields!=="undefined"){F=w.customfields[G]}if(F.length>0){r+='<td><a href="'+F+'" target="_blank">View</a> | <br/><a href="'+site_url+"home/download?filePath="+F+'">Download</a></td>'}else{r+="<td>&nbsp;</td>"}})}r+=("</tr>");$("#transactionTable tr:last").after(r);r="";u++})})}if(f>(k*d)){$("#loadMoreTransactions").text("Load More");$("#loadMoreTransactions").prop("disabled",false)}else{$("#loadMoreTransactions").hide()}$("#SNo").val(p)}}function h(p){alert(p.responseJSON.response.messages);$("#loadMoreTransactions").prop("disabled",false);$("#loadMoreTransactions").text("Load More")}getPageResponse(g,a,l,m,n,h)});$("#exportReports").on("click",function(){$("#exportReports").prop("disabled",true);var a=$("#eventId").val();var c=$("#selectTransType").val();var h=$("input:radio[name=reportType]:checked");var f="";if(h.length>0){f=h.val()}var b=$("#currencyCode").val();var g=$("#promoterCode").val();var d=$("#selectTicketType").val();var i="eventid="+a+"&reporttype="+f+"&transactiontype="+c;if(b!=""){i+="&currencycode="+b}if(g!=""){i+="&promotercode="+g}if(d>0){i+="&ticketid="+d}var e=api_reportsExportTransactions+"?"+i;window.location.href=e;$("#exportReports").prop("disabled",false)});$("#emailAttachedReports").on("click",function(){var b=$("#eventId").val();var d=$("#selectTransType").val();var j=$("input:radio[name=reportType]:checked");var h="";if(j.length>0){h=j.val()}var c=$("#currencyCode").val();var i=$("#promoterCode").val();var e=$("#selectTicketType").val();var k="eventid="+b+"&reporttype="+h+"&transactiontype="+d;if(c!=""){k+="&currencycode="+c}if(i!=""){k+="&promotercode="+i}if(e>0){k+="&ticketid="+e}var f=api_reportsEmailTransactions;var a="POST";var l="JSON";getPageResponse(f,a,k,l,m,g);function g(n){alert(n.responseJSON.response.messages)}function m(n){if(n.response.total>0){alert(n.response.email)}else{alert(n.response.messages)}}})});function downloadAllImages(d){var b=new JSZip();var c=[];for(var a=0;a<d.length;a++){c.push(addToZip(b,d[a],a))}$.when.apply(window,c).done(generateZip,true);return true}function generateZip(b){var c=b.generate({type:"blob"});var a=$("#eventId").val();saveAs(c,a+"_CustomfieldImages.zip")}function addToZip(c,d,b){var a=$.Deferred();JSZipUtils.getBinaryContent(d,function(e,f){if(e){console.log("Problem happened when download img: "+d);a.resolve(c)}else{var g=d.substr(d.lastIndexOf("/")+1);c.file(g,f,{binary:true});a.resolve(c)}});return a};